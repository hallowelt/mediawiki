"use strict";var R=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var w=(e,o)=>{var u={};for(var l in e)H.call(e,l)&&o.indexOf(l)<0&&(u[l]=e[l]);if(e!=null&&R)for(var l of R(e))o.indexOf(l)<0&&O.call(e,l)&&(u[l]=e[l]);return u};const t=require("vue"),N=require("./Icon.js"),W=require("./CdxMenu.js"),G=require("./CdxSearchInput.js"),j=require("./useGeneratedId.js"),J=require("./useSplitAttributes.js"),h=require("./constants.js"),X=require("./_plugin-vue_export-helper.js");require("./CdxMenuItem.js");require("./CdxThumbnail.js");require("./CdxSearchResultTitle.js");require("./CdxProgressBar.js");require("./useWarnOnce.js");require("./useIntersectionObserver.js");require("./CdxButton.js");require("./useIconOnlyButton.js");require("./useSlotContents.js");require("./CdxTextInput.js");require("./useModelWrapper.js");require("./useFieldData.js");const Y=t.defineComponent({name:"CdxTypeaheadSearch",components:{CdxIcon:N.CdxIcon,CdxMenu:W,CdxSearchInput:G},inheritAttrs:!1,props:{id:{type:String,required:!0},formAction:{type:String,required:!0},searchResultsLabel:{type:String,required:!0},searchResults:{type:Array,required:!0},buttonLabel:{type:String,default:""},initialInputValue:{type:String,default:""},searchFooterUrl:{type:String,default:""},debounceInterval:{type:Number,default:h.DebounceInterval},highlightQuery:{type:Boolean,default:!1},showThumbnail:{type:Boolean,default:!1},autoExpandWidth:{type:Boolean,default:!1},visibleItemLimit:{type:Number,default:null}},emits:["input","search-result-click","submit","load-more"],setup(e,{attrs:o,emit:u,slots:l}){const S=t.ref(),i=t.ref(),C=j.useGeneratedId("typeahead-search-menu"),r=t.ref(!1),g=t.ref(!1),s=t.ref(!1),p=t.ref(!1),m=t.ref(e.initialInputValue),f=t.ref(""),x=t.computed(()=>{var a,n;return(n=(a=i.value)==null?void 0:a.getHighlightedMenuItem())==null?void 0:n.id}),y=t.ref(null),k=t.computed(()=>({"cdx-typeahead-search__menu-message--has-thumbnail":e.showThumbnail})),d=t.computed(()=>e.searchResults.find(a=>a.value===y.value)),M=t.computed(()=>e.searchFooterUrl?{value:h.MenuFooterValue,url:e.searchFooterUrl}:void 0),F=t.computed(()=>({"cdx-typeahead-search--show-thumbnail":e.showThumbnail,"cdx-typeahead-search--expanded":r.value,"cdx-typeahead-search--auto-expand-width":e.showThumbnail&&e.autoExpandWidth})),{rootClasses:T,rootStyle:U,otherAttrs:A}=J.useSplitAttributes(o,F);function E(a){return a}const $=t.computed(()=>({visibleItemLimit:e.visibleItemLimit,showThumbnail:e.showThumbnail,boldLabel:!0,hideDescriptionOverflow:!0}));let b,v;function I(a,n=!1){d.value&&d.value.label!==a&&d.value.value!==a&&(y.value=null),v!==void 0&&(clearTimeout(v),v=void 0),a===""?r.value=!1:(g.value=!0,l["search-results-pending"]&&(v=setTimeout(()=>{p.value&&(r.value=!0),s.value=!0},h.PendingDelay))),b!==void 0&&(clearTimeout(b),b=void 0);const c=()=>{u("input",a)};n?c():b=setTimeout(()=>{c()},e.debounceInterval)}function K(a){var n;if(a===h.MenuFooterValue){y.value=null,m.value=f.value;return}y.value=a,a!==null&&(m.value=d.value?(n=d.value.label)!=null?n:String(d.value.value):"")}function B(){p.value=!0,(f.value||s.value)&&(r.value=!0)}function L(){p.value=!1,r.value=!1}function V(a){const q=a,{id:n}=q,c=w(q,["id"]);if(c.value===h.MenuFooterValue){u("search-result-click",{searchResult:null,index:e.searchResults.length,numberOfResults:e.searchResults.length});return}_(c)}function _(a){const n={searchResult:a,index:e.searchResults.findIndex(c=>c.value===a.value),numberOfResults:e.searchResults.length};u("search-result-click",n)}function Q(a){var n;if(a.value===h.MenuFooterValue){m.value=f.value;return}m.value=a.value?(n=a.label)!=null?n:String(a.value):""}function D(a){var n;r.value=!1,(n=i.value)==null||n.clearActive(),V(a)}function P(a){if(d.value)_(d.value),a.stopPropagation(),window.location.assign(d.value.url),a.preventDefault();else{const n={searchResult:null,index:-1,numberOfResults:e.searchResults.length};u("submit",n)}}function z(a){if(!i.value||!f.value||a.key===" ")return;const n=i.value.getHighlightedMenuItem(),c=i.value.getHighlightedViaKeyboard();switch(a.key){case"Enter":n&&(n.value===h.MenuFooterValue&&c?window.location.assign(e.searchFooterUrl):i.value.delegateKeyNavigation(a,{prevent:!1})),r.value=!1;break;case"Tab":r.value=!1;break;default:i.value.delegateKeyNavigation(a);break}}return t.onMounted(()=>{e.initialInputValue&&I(e.initialInputValue,!0)}),t.watch(t.toRef(e,"searchResults"),()=>{f.value=m.value.trim(),p.value&&g.value&&f.value.length>0&&(r.value=!0),v!==void 0&&(clearTimeout(v),v=void 0),g.value=!1,s.value=!1}),{form:S,menu:i,menuId:C,highlightedId:x,selection:y,menuMessageClass:k,footer:M,asSearchResult:E,inputValue:m,searchQuery:f,expanded:r,showPending:s,rootClasses:T,rootStyle:U,otherAttrs:A,menuConfig:$,onUpdateInputValue:I,onUpdateMenuSelection:K,onFocus:B,onBlur:L,onSearchResultClick:V,onSearchResultKeyboardNavigation:Q,onSearchFooterClick:D,onSubmit:P,onKeydown:z,MenuFooterValue:h.MenuFooterValue,articleIcon:N.F4}},methods:{focus(){this.$refs.searchInput.focus()}}});const Z=["id","action"],ee={class:"cdx-typeahead-search__menu-message__text"},te={class:"cdx-typeahead-search__menu-message__text"},ae=["href","onClickCapture"],ne={class:"cdx-menu-item__text cdx-typeahead-search__search-footer__text"},se={class:"cdx-typeahead-search__search-footer__query"};function oe(e,o,u,l,S,i){const C=t.resolveComponent("cdx-icon"),r=t.resolveComponent("cdx-menu"),g=t.resolveComponent("cdx-search-input");return t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["cdx-typeahead-search",e.rootClasses]),style:t.normalizeStyle(e.rootStyle)},[t.createElementVNode("form",{id:e.id,ref:"form",class:"cdx-typeahead-search__form",action:e.formAction,onSubmit:o[4]||(o[4]=(...s)=>e.onSubmit&&e.onSubmit(...s))},[t.createVNode(g,t.mergeProps({ref:"searchInput",modelValue:e.inputValue,"onUpdate:modelValue":o[3]||(o[3]=s=>e.inputValue=s),"button-label":e.buttonLabel},e.otherAttrs,{class:"cdx-typeahead-search__input",name:"search",role:"combobox",autocomplete:"off","aria-autocomplete":"list","aria-controls":e.menuId,"aria-expanded":e.expanded,"aria-activedescendant":e.highlightedId,"onUpdate:modelValue":e.onUpdateInputValue,onFocus:e.onFocus,onBlur:e.onBlur,onKeydown:e.onKeydown}),{default:t.withCtx(()=>[t.createVNode(r,t.mergeProps({id:e.menuId,ref:"menu",expanded:e.expanded,"onUpdate:expanded":o[0]||(o[0]=s=>e.expanded=s),class:"cdx-typeahead-search__menu","show-pending":e.showPending,selected:e.selection,"menu-items":e.searchResults,footer:e.footer,"search-query":e.highlightQuery?e.searchQuery:"","show-no-results-slot":e.searchQuery.length>0&&e.searchResults.length===0&&e.$slots["search-no-results-text"]&&e.$slots["search-no-results-text"]().length>0},e.menuConfig,{"aria-label":e.searchResultsLabel,"onUpdate:selected":e.onUpdateMenuSelection,onMenuItemClick:o[1]||(o[1]=s=>e.onSearchResultClick(e.asSearchResult(s))),onMenuItemKeyboardNavigation:e.onSearchResultKeyboardNavigation,onLoadMore:o[2]||(o[2]=s=>e.$emit("load-more"))}),{pending:t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(["cdx-menu-item__content cdx-typeahead-search__menu-message",e.menuMessageClass])},[t.createElementVNode("span",ee,[t.createCommentVNode('\n									@slot A slot for a translated "Loading search results" message.\n								'),t.renderSlot(e.$slots,"search-results-pending")])],2)]),"no-results":t.withCtx(()=>[t.createElementVNode("div",{class:t.normalizeClass(["cdx-menu-item__content cdx-typeahead-search__menu-message",e.menuMessageClass])},[t.createElementVNode("span",te,[t.createCommentVNode('\n									@slot A slot for passing in a translated "no results" message.\n								'),t.renderSlot(e.$slots,"search-no-results-text")])],2)]),default:t.withCtx(({menuItem:s,active:p})=>[s.value===e.MenuFooterValue?(t.openBlock(),t.createElementBlock("a",{key:0,class:t.normalizeClass(["cdx-menu-item__content cdx-typeahead-search__search-footer",{"cdx-typeahead-search__search-footer__active":p}]),href:e.asSearchResult(s).url,onClickCapture:t.withModifiers(m=>e.onSearchFooterClick(e.asSearchResult(s)),["stop"])},[t.createCommentVNode(" eslint-disable max-len "),t.createVNode(C,{class:"cdx-menu-item__thumbnail cdx-typeahead-search__search-footer__icon",icon:e.articleIcon},null,8,["icon"]),t.createElementVNode("span",ne,[t.createCommentVNode(" eslint-enable max-len "),t.createCommentVNode("\n									@slot A slot for passing in translated search footer text.\n									@binding {string} search-query Input text entered by the user\n								"),t.renderSlot(e.$slots,"search-footer-text",{searchQuery:e.searchQuery},()=>[t.createElementVNode("strong",se,t.toDisplayString(e.searchQuery),1)])])],42,ae)):t.createCommentVNode("v-if",!0)]),_:3},16,["id","expanded","show-pending","selected","menu-items","footer","search-query","show-no-results-slot","aria-label","onUpdate:selected","onMenuItemKeyboardNavigation"])]),_:3},16,["modelValue","button-label","aria-controls","aria-expanded","aria-activedescendant","onUpdate:modelValue","onFocus","onBlur","onKeydown"]),t.createCommentVNode('\n				@slot A slot for passing hidden inputs, i.e.\n				`<input type="hidden" name="language" value="en">`\n			'),t.renderSlot(e.$slots,"default")],40,Z)],6)}const le=X._export_sfc(Y,[["render",oe]]);module.exports=le;
