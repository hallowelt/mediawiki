"use strict";var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var H=(e,a,o)=>a in e?X(e,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[a]=o,P=(e,a)=>{for(var o in a||(a={}))ee.call(a,o)&&H(e,o,a[o]);if(_)for(var o of _(a))te.call(a,o)&&H(e,o,a[o]);return e},A=(e,a)=>Y(e,Z(a));var N=(e,a,o)=>new Promise((B,d)=>{var x=i=>{try{f(o.next(i))}catch(b){d(b)}},r=i=>{try{f(o.throw(i))}catch(b){d(b)}},f=i=>i.done?B(i.value):Promise.resolve(i.value).then(x,r);f((o=o.apply(e,a)).next())});const n=require("vue"),ne=require("./CdxMenuItem.js"),le=require("./CdxProgressBar.js"),ae=require("./useGeneratedId.js"),ie=require("./useIntersectionObserver.js"),oe=require("./useSplitAttributes.js"),re=require("./_plugin-vue_export-helper.js");require("./Icon.js");require("./useComputedDirection.js");require("./useComputedLanguage.js");require("./constants.js");require("./CdxThumbnail.js");require("./CdxSearchResultTitle.js");require("./useWarnOnce.js");const ue=n.defineComponent({name:"CdxMenu",components:{CdxMenuItem:ne,CdxProgressBar:le},inheritAttrs:!1,props:{menuItems:{type:Array,required:!0},footer:{type:Object,default:null},selected:{type:[String,Number,null],required:!0},expanded:{type:Boolean,required:!0},showPending:{type:Boolean,default:!1},visibleItemLimit:{type:Number,default:null},showThumbnail:{type:Boolean,default:!1},boldLabel:{type:Boolean,default:!1},hideDescriptionOverflow:{type:Boolean,default:!1},searchQuery:{type:String,default:""},showNoResultsSlot:{type:Boolean,default:null}},emits:["update:selected","update:expanded","menu-item-click","menu-item-keyboard-navigation","load-more"],expose:["isExpanded","clearActive","getHighlightedMenuItem","getHighlightedViaKeyboard","delegateKeyNavigation"],setup(e,{emit:a,slots:o,attrs:B}){const d=n.computed(()=>(e.footer&&e.menuItems?[...e.menuItems,e.footer]:e.menuItems).map(l=>A(P({},l),{id:ae("menu-item")}))),x=n.computed(()=>o["no-results"]?e.showNoResultsSlot!==null?e.showNoResultsSlot:d.value.length===0:!1),r=n.ref(null),f=n.ref(!1),i=n.ref(null),b="additions removals";let c="",m=null;function v(){c="",m!==null&&(clearTimeout(m),m=null)}function k(){m!==null&&clearTimeout(m),m=setTimeout(v,1500)}function C(){var t;return(t=d.value.find(l=>l.value===e.selected))!=null?t:null}function g(t,l){var u;if(!(l&&l.disabled))switch(t){case"selected":a("update:selected",(u=l==null?void 0:l.value)!=null?u:null),a("update:expanded",!1),i.value=null;break;case"highlighted":r.value=l!=null?l:null,f.value=!1;break;case"highlightedViaKeyboard":r.value=l!=null?l:null,f.value=!0;break;case"active":i.value=l!=null?l:null;break}}const y=n.computed(()=>{if(r.value!==null)return d.value.findIndex(t=>t.value===r.value.value)});function T(t){t&&(g("highlightedViaKeyboard",t),a("menu-item-keyboard-navigation",t))}function q(t){var s;const l=w=>{for(let h=w-1;h>=0;h--)if(!d.value[h].disabled)return d.value[h]};t=t!=null?t:d.value.length;const u=(s=l(t))!=null?s:l(d.value.length);T(u)}function E(t){var s;const l=w=>d.value.find((h,K)=>!h.disabled&&K>w);t=t!=null?t:-1;const u=(s=l(t))!=null?s:l(-1);T(u)}function D(t){if(t.key==="Clear")return v(),!0;if(t.key==="Backspace")return c=c.slice(0,-1),k(),!0;if(t.key.length===1&&!t.metaKey&&!t.ctrlKey&&!t.altKey){if(e.expanded||a("update:expanded",!0),t.key===" "&&c.length<1)return!1;c+=t.key.toLowerCase();const l=c.length>1&&c.split("").every(h=>h===c[0]);let u=d.value,s=c;l&&y.value!==void 0&&(u=u.slice(y.value+1).concat(u.slice(0,y.value)),s=c[0]);const w=u.find(h=>{var K;return!h.disabled&&String((K=h.label)!=null?K:h.value).toLowerCase().startsWith(s)});return w&&(g("highlightedViaKeyboard",w),M()),k(),!0}return!1}function I(t,{prevent:l=!0,characterNavigation:u=!1}={}){if(u){if(D(t))return t.preventDefault(),!0;v()}function s(){l&&(t.preventDefault(),t.stopPropagation())}switch(t.key){case"Enter":case" ":return s(),e.expanded?(r.value&&f.value&&a("update:selected",r.value.value),a("update:expanded",!1)):a("update:expanded",!0),!0;case"Tab":return e.expanded&&(r.value&&f.value&&a("update:selected",r.value.value),a("update:expanded",!1)),!0;case"ArrowUp":return s(),e.expanded?(r.value===null&&g("highlightedViaKeyboard",C()),q(y.value)):a("update:expanded",!0),M(),!0;case"ArrowDown":return s(),e.expanded?(r.value===null&&g("highlightedViaKeyboard",C()),E(y.value)):a("update:expanded",!0),M(),!0;case"Home":return s(),e.expanded?(r.value===null&&g("highlightedViaKeyboard",C()),E()):a("update:expanded",!0),M(),!0;case"End":return s(),e.expanded?(r.value===null&&g("highlightedViaKeyboard",C()),q()):a("update:expanded",!0),M(),!0;case"Escape":return s(),a("update:expanded",!1),!0;default:return!1}}function L(){g("active",null)}const p=[],$=n.ref(void 0),F=ie($,{threshold:.8});n.watch(F,t=>{t&&a("load-more")});function O(t,l){if(t){p[l]=t.$el;const u=e.visibleItemLimit;if(!u||e.menuItems.length<u)return;const s=Math.min(u,Math.max(2,Math.floor(.2*e.menuItems.length)));l===e.menuItems.length-s&&($.value=t.$el)}}function M(){if(!e.visibleItemLimit||e.visibleItemLimit>e.menuItems.length||y.value===void 0)return;const t=y.value>=0?y.value:0;p[t].scrollIntoView({behavior:"smooth",block:"nearest"})}const V=n.ref(null),S=n.ref(null);function R(){return N(this,null,function*(){yield n.nextTick(),W(),z(),yield n.nextTick(),M()})}function W(){if(e.footer){const t=p[p.length-1];S.value=t.scrollHeight}else S.value=null}function z(){if(!e.visibleItemLimit||p.length<=e.visibleItemLimit){V.value=null;return}const t=p[0].getBoundingClientRect().top,l=p[e.visibleItemLimit].getBoundingClientRect().top;V.value=l-t+2}n.onMounted(()=>{document.addEventListener("mouseup",L)}),n.onUnmounted(()=>{document.removeEventListener("mouseup",L)}),n.watch(n.toRef(e,"expanded"),t=>N(this,null,function*(){if(t){const l=C();l&&!r.value&&g("highlighted",l),yield R()}else g("highlighted",null)})),n.watch(n.toRef(e,"menuItems"),t=>N(this,null,function*(){t.length<p.length&&(p.length=t.length),e.expanded&&(yield R())}),{deep:!0});const U=n.computed(()=>({"max-height":V.value?"".concat(V.value,"px"):void 0,"margin-bottom":S.value?"".concat(S.value,"px"):void 0})),Q=n.computed(()=>({"cdx-menu--has-footer":!!e.footer})),{rootClasses:j,rootStyle:G,otherAttrs:J}=oe(B,Q);return{listBoxStyle:U,rootClasses:j,rootStyle:G,otherAttrs:J,assignTemplateRef:O,computedMenuItems:d,computedShowNoResultsSlot:x,highlightedMenuItem:r,highlightedViaKeyboard:f,activeMenuItem:i,handleMenuItemChange:g,handleKeyNavigation:I,ariaRelevant:b}},methods:{isExpanded(){return this.expanded},getHighlightedMenuItem(){return this.expanded?this.highlightedMenuItem:null},getHighlightedViaKeyboard(){return this.highlightedViaKeyboard},clearActive(){this.handleMenuItemChange("active",null)},delegateKeyNavigation(e,{prevent:a=!0,characterNavigation:o=!1}={}){return this.handleKeyNavigation(e,{prevent:a,characterNavigation:o})}}});const se=["aria-live","aria-relevant"],de={key:0,class:"cdx-menu__pending cdx-menu-item"},ce={key:1,class:"cdx-menu__no-results cdx-menu-item"};function he(e,a,o,B,d,x){const r=n.resolveComponent("cdx-menu-item"),f=n.resolveComponent("cdx-progress-bar");return n.withDirectives((n.openBlock(),n.createElementBlock("div",{class:n.normalizeClass(["cdx-menu",e.rootClasses]),style:n.normalizeStyle(e.rootStyle)},[n.createElementVNode("ul",n.mergeProps({class:"cdx-menu__listbox",role:"listbox",style:e.listBoxStyle,"aria-live":e.showPending?"polite":void 0,"aria-relevant":e.showPending?e.ariaRelevant:void 0},e.otherAttrs),[e.showPending&&e.computedMenuItems.length===0&&e.$slots.pending?(n.openBlock(),n.createElementBlock("li",de,[n.createCommentVNode("\n					@slot Message to indicate pending state.\n				"),n.renderSlot(e.$slots,"pending")])):n.createCommentVNode("v-if",!0),e.computedShowNoResultsSlot?(n.openBlock(),n.createElementBlock("li",ce,[n.createCommentVNode("\n					@slot Message to show if there are no menu items to display.\n				"),n.renderSlot(e.$slots,"no-results")])):n.createCommentVNode("v-if",!0),(n.openBlock(!0),n.createElementBlock(n.Fragment,null,n.renderList(e.computedMenuItems,(i,b)=>{var c,m;return n.openBlock(),n.createBlock(r,n.mergeProps({key:i.value,ref_for:!0,ref:v=>e.assignTemplateRef(v,b)},i,{selected:i.value===e.selected,active:i.value===((c=e.activeMenuItem)==null?void 0:c.value),highlighted:i.value===((m=e.highlightedMenuItem)==null?void 0:m.value),"show-thumbnail":e.showThumbnail,"bold-label":e.boldLabel,"hide-description-overflow":e.hideDescriptionOverflow,"search-query":e.searchQuery,onChange:(v,k)=>e.handleMenuItemChange(v,k?i:null),onClick:v=>e.$emit("menu-item-click",i)}),{default:n.withCtx(()=>{var v,k;return[n.createCommentVNode("\n					@slot Display of an individual item in the menu\n					@binding {MenuItem} menuItem The current menu item\n					@binding {boolean} active Whether the current item is visually active\n				"),n.renderSlot(e.$slots,"default",{menuItem:i,active:i.value===((v=e.activeMenuItem)==null?void 0:v.value)&&i.value===((k=e.highlightedMenuItem)==null?void 0:k.value)})]}),_:2},1040,["selected","active","highlighted","show-thumbnail","bold-label","hide-description-overflow","search-query","onChange","onClick"])}),128)),e.showPending?(n.openBlock(),n.createBlock(f,{key:2,class:"cdx-menu__progress-bar",inline:!0})):n.createCommentVNode("v-if",!0)],16,se)],6)),[[n.vShow,e.expanded]])}const fe=re._export_sfc(ue,[["render",he]]);module.exports=fe;
