"use strict";var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var P=(e,a,u)=>a in e?J(e,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[a]=u,A=(e,a)=>{for(var u in a||(a={}))Z.call(a,u)&&P(e,u,a[u]);if(_)for(var u of _(a))ee.call(a,u)&&P(e,u,a[u]);return e},H=(e,a)=>X(e,Y(a));var V=(e,a,u)=>new Promise((B,d)=>{var S=i=>{try{f(u.next(i))}catch(p){d(p)}},o=i=>{try{f(u.throw(i))}catch(p){d(p)}},f=i=>i.done?B(i.value):Promise.resolve(i.value).then(S,o);f((u=u.apply(e,a)).next())});const l=require("vue"),te=require("./CdxMenuItem.js"),le=require("./CdxProgressBar.js"),ne=require("./useGeneratedId.js"),ae=require("./useIntersectionObserver.js"),ie=require("./useSplitAttributes.js"),re=require("./_plugin-vue_export-helper.js");require("./Icon.js");require("./constants.js");require("./CdxThumbnail.js");require("./CdxSearchResultTitle.js");require("./useWarnOnce.js");const ue=l.defineComponent({name:"CdxMenu",components:{CdxMenuItem:te,CdxProgressBar:le},inheritAttrs:!1,props:{menuItems:{type:Array,required:!0},footer:{type:Object,default:null},selected:{type:[String,Number,null],required:!0},expanded:{type:Boolean,required:!0},showPending:{type:Boolean,default:!1},visibleItemLimit:{type:Number,default:null},showThumbnail:{type:Boolean,default:!1},boldLabel:{type:Boolean,default:!1},hideDescriptionOverflow:{type:Boolean,default:!1},searchQuery:{type:String,default:""},showNoResultsSlot:{type:Boolean,default:null}},emits:["update:selected","update:expanded","menu-item-click","menu-item-keyboard-navigation","load-more"],expose:["isExpanded","clearActive","getHighlightedMenuItem","getHighlightedViaKeyboard","delegateKeyNavigation"],setup(e,{emit:a,slots:u,attrs:B}){const d=l.computed(()=>(e.footer&&e.menuItems?[...e.menuItems,e.footer]:e.menuItems).map(n=>H(A({},n),{id:ne.useGeneratedId("menu-item")}))),S=l.computed(()=>u["no-results"]?e.showNoResultsSlot!==null?e.showNoResultsSlot:d.value.length===0:!1),o=l.ref(null),f=l.ref(!1),i=l.ref(null),p="additions removals";let c="",m=null;function v(){c="",m!==null&&(clearTimeout(m),m=null)}function k(){m!==null&&clearTimeout(m),m=setTimeout(v,1500)}function x(){var t;return(t=d.value.find(n=>n.value===e.selected))!=null?t:null}function g(t,n){var r;if(!(n&&n.disabled))switch(t){case"selected":a("update:selected",(r=n==null?void 0:n.value)!=null?r:null),a("update:expanded",!1),i.value=null;break;case"highlighted":o.value=n!=null?n:null,f.value=!1;break;case"highlightedViaKeyboard":o.value=n!=null?n:null,f.value=!0;break;case"active":i.value=n!=null?n:null;break}}const b=l.computed(()=>{if(o.value!==null)return d.value.findIndex(t=>t.value===o.value.value)});function E(t){t&&(g("highlightedViaKeyboard",t),a("menu-item-keyboard-navigation",t))}function N(t){var s;const n=C=>{for(let h=C-1;h>=0;h--)if(!d.value[h].disabled)return d.value[h]};t=t!=null?t:d.value.length;const r=(s=n(t))!=null?s:n(d.value.length);E(r)}function q(t){var s;const n=C=>d.value.find((h,K)=>!h.disabled&&K>C);t=t!=null?t:-1;const r=(s=n(t))!=null?s:n(-1);E(r)}function I(t){if(t.key==="Clear")return v(),!0;if(t.key==="Backspace")return c=c.slice(0,-1),k(),!0;if(t.key.length===1&&!t.metaKey&&!t.ctrlKey&&!t.altKey){e.expanded||a("update:expanded",!0),c+=t.key.toLowerCase();const n=c.length>1&&c.split("").every(h=>h===c[0]);let r=d.value,s=c;n&&b.value!==void 0&&(r=r.slice(b.value+1).concat(r.slice(0,b.value)),s=c[0]);const C=r.find(h=>{var K;return!h.disabled&&String((K=h.label)!=null?K:h.value).toLowerCase().startsWith(s)});return C&&(g("highlightedViaKeyboard",C),w()),k(),!0}return!1}function D(t,{prevent:n=!0,characterNavigation:r=!1}={}){if(r){if(I(t))return!0;v()}function s(){n&&(t.preventDefault(),t.stopPropagation())}switch(t.key){case"Enter":case" ":return s(),e.expanded?(o.value&&f.value&&a("update:selected",o.value.value),a("update:expanded",!1)):a("update:expanded",!0),!0;case"Tab":return e.expanded&&(o.value&&f.value&&a("update:selected",o.value.value),a("update:expanded",!1)),!0;case"ArrowUp":return s(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),N(b.value)):a("update:expanded",!0),w(),!0;case"ArrowDown":return s(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),q(b.value)):a("update:expanded",!0),w(),!0;case"Home":return s(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),q()):a("update:expanded",!0),w(),!0;case"End":return s(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),N()):a("update:expanded",!0),w(),!0;case"Escape":return s(),a("update:expanded",!1),!0;default:return!1}}function L(){g("active",null)}const y=[],$=l.ref(void 0),O=ae.useIntersectionObserver($,{threshold:.8});l.watch(O,t=>{t&&a("load-more")});function z(t,n){if(t){y[n]=t.$el;const r=e.visibleItemLimit;if(!r||e.menuItems.length<r)return;const s=Math.min(r,Math.max(2,Math.floor(.2*e.menuItems.length)));n===e.menuItems.length-s&&($.value=t.$el)}}function w(){if(!e.visibleItemLimit||e.visibleItemLimit>e.menuItems.length||b.value===void 0)return;const t=b.value>=0?b.value:0;y[t].scrollIntoView({behavior:"smooth",block:"nearest"})}const M=l.ref(null),T=l.ref(null);function R(){if(T.value=null,!e.visibleItemLimit||y.length<=e.visibleItemLimit){M.value=null;return}const t=y[0],n=y[e.visibleItemLimit];if(M.value=F(t,n),e.footer){const r=y[y.length-1];T.value=r.scrollHeight}}function F(t,n){const r=t.getBoundingClientRect().top;return n.getBoundingClientRect().top-r+2}l.onMounted(()=>{document.addEventListener("mouseup",L)}),l.onUnmounted(()=>{document.removeEventListener("mouseup",L)}),l.watch(l.toRef(e,"expanded"),t=>V(this,null,function*(){if(t){const n=x();n&&!o.value&&g("highlighted",n),yield l.nextTick(),R(),yield l.nextTick(),w()}else g("highlighted",null)})),l.watch(l.toRef(e,"menuItems"),t=>V(this,null,function*(){t.length<y.length&&(y.length=t.length),e.expanded&&(yield l.nextTick(),R(),yield l.nextTick(),w())}),{deep:!0});const U=l.computed(()=>({"max-height":M.value?"".concat(M.value,"px"):void 0,"overflow-y":M.value?"scroll":void 0,"margin-bottom":T.value?"".concat(T.value,"px"):void 0})),W=l.computed(()=>({"cdx-menu--has-footer":!!e.footer,"cdx-menu--has-sticky-footer":!!e.footer&&!!M.value})),{rootClasses:G,rootStyle:Q,otherAttrs:j}=ie.useSplitAttributes(B,W);return{listBoxStyle:U,rootClasses:G,rootStyle:Q,otherAttrs:j,assignTemplateRef:z,computedMenuItems:d,computedShowNoResultsSlot:S,highlightedMenuItem:o,highlightedViaKeyboard:f,activeMenuItem:i,handleMenuItemChange:g,handleKeyNavigation:D,ariaRelevant:p}},methods:{isExpanded(){return this.expanded},getHighlightedMenuItem(){return this.expanded?this.highlightedMenuItem:null},getHighlightedViaKeyboard(){return this.highlightedViaKeyboard},clearActive(){this.handleMenuItemChange("active",null)},delegateKeyNavigation(e,{prevent:a=!0,characterNavigation:u=!1}={}){return this.handleKeyNavigation(e,{prevent:a,characterNavigation:u})}}});const oe=["aria-live","aria-relevant"],se={key:0,class:"cdx-menu__pending cdx-menu-item"},de={key:1,class:"cdx-menu__no-results cdx-menu-item"};function ce(e,a,u,B,d,S){const o=l.resolveComponent("cdx-menu-item"),f=l.resolveComponent("cdx-progress-bar");return l.withDirectives((l.openBlock(),l.createElementBlock("div",{class:l.normalizeClass(["cdx-menu",e.rootClasses]),style:l.normalizeStyle(e.rootStyle)},[l.createElementVNode("ul",l.mergeProps({class:"cdx-menu__listbox",role:"listbox",style:e.listBoxStyle,"aria-live":e.showPending?"polite":void 0,"aria-relevant":e.showPending?e.ariaRelevant:void 0},e.otherAttrs),[e.showPending&&e.computedMenuItems.length===0&&e.$slots.pending?(l.openBlock(),l.createElementBlock("li",se,[l.renderSlot(e.$slots,"pending")])):l.createCommentVNode("",!0),e.computedShowNoResultsSlot?(l.openBlock(),l.createElementBlock("li",de,[l.renderSlot(e.$slots,"no-results")])):l.createCommentVNode("",!0),(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(e.computedMenuItems,(i,p)=>{var c,m;return l.openBlock(),l.createBlock(o,l.mergeProps({key:i.value,ref_for:!0,ref:v=>e.assignTemplateRef(v,p)},i,{selected:i.value===e.selected,active:i.value===((c=e.activeMenuItem)==null?void 0:c.value),highlighted:i.value===((m=e.highlightedMenuItem)==null?void 0:m.value),"show-thumbnail":e.showThumbnail,"bold-label":e.boldLabel,"hide-description-overflow":e.hideDescriptionOverflow,"search-query":e.searchQuery,onChange:(v,k)=>e.handleMenuItemChange(v,k?i:null),onClick:v=>e.$emit("menu-item-click",i)}),{default:l.withCtx(()=>{var v,k;return[l.renderSlot(e.$slots,"default",{menuItem:i,active:i.value===((v=e.activeMenuItem)==null?void 0:v.value)&&i.value===((k=e.highlightedMenuItem)==null?void 0:k.value)})]}),_:2},1040,["selected","active","highlighted","show-thumbnail","bold-label","hide-description-overflow","search-query","onChange","onClick"])}),128)),e.showPending?(l.openBlock(),l.createBlock(f,{key:2,class:"cdx-menu__progress-bar",inline:!0})):l.createCommentVNode("",!0)],16,oe)],6)),[[l.vShow,e.expanded]])}const he=re._export_sfc(ue,[["render",ce]]);module.exports=he;
